<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script src="../scripts/productLogic.js" type="module"></script>
    <style>
      nav {
        background-color: rgb(189, 189, 233);
        position: sticky;
      }
      .footer {
        background-color: rgb(189, 189, 233);
        padding: 20px 0;
        color: #fff;
      }
      .product-image {
        width: 100%;
        height: auto;
      }
      .img-thumbnail {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div id="product-details" class="row"></div>
    </div>

    <script type="module">
      import {
        initializeData,
        getProducts,
        addToCart,
      } from '../scripts/productLogic.js';

      $(document).ready(async () => {
        // Initialize data
        await initializeData();

        // Parse the query string to get the product ID
        const urlParams = new URLSearchParams(window.location.search);
        const productId = parseInt(urlParams.get('id'), 10);

        // Fetch products from local storage
        const products = getProducts();

        // Get the specific product by ID
        const product = products.find((p) => p.id === productId);

        const $productDetails = $('#product-details');

        if (product) {
          // Display product details
          const productHTML = `
                <div class="col-md-6">
                    <!-- Product Image -->
                    <img src="${product.image}" alt="${
            product.name
          }" class="product-image">
                </div>
                <div class="col-md-6">
                    <!-- Product Info -->
                    <h1>${product.name}</h1>
                    <p class="text-muted">$${product.price.toFixed(2)}</p>
                    <p><strong>Type:</strong> ${product.type}</p>
                    <p><strong>Description:</strong> ${product.description}</p>
                    <p><strong>Rating:</strong> ${product.rating} â˜…</p>
                    <p><strong>Stock:</strong> 
                        ${
                          product.stock > 0
                            ? `<span class="text-success">In Stock (${product.stock})</span>`
                            : '<span class="text-danger">Out of Stock</span>'
                        }
                    </p>
    
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity:</label>
                        <input type="number" class="form-control" id="quantity" value="1" min="1" max="${
                          product.stock
                        }">
                    </div>
    
                    <button id="buy-now" class="btn btn-primary w-100" ${
                      product.stock > 0 ? '' : 'disabled'
                    }>Buy Now</button>
                </div>
            `;
          $productDetails.html(productHTML);

          // Add event listener to the "Buy Now" button
          $('#buy-now').on('click', () => {
            let currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
              let quantity = parseInt($('#quantity').val());
              addToCart(currentUser['username'], product.id, quantity);
            } else alert('please login to use the cart');
          });
        } else {
          // Display a message if the product is not found
          $productDetails.html('<p>Product not found.</p>');
        }
      });
    </script>
  </body>
</html>
